import{nanoid as t}from"nanoid";var n=[],e="",r=function(t,n){return Array.isArray(t)?-1!==t.indexOf(n):t===n};function i(){return window.location.pathname.replace(e,"")}function o(){var t=i(),e=n.every(function(n){return!r(n.path,t)});n.forEach(function(n){var i=n.path,o=n.element,a=n.parent,u=void 0===a?window.document.body:a;r(i,t)||e&&r(i,"")?u.append(o):u.contains(o)&&o.remove()})}function a(t){var n=""+e+t;window.history.pushState({path:n},"",n),o();var r=t.indexOf("#");if(-1!==r){var i=t.substring(r+1),a=window.document.getElementById(i);a&&window.scrollTo(0,a.offsetTop)}}window.addEventListener("popstate",function(){return o()});var u={__proto__:null,set:function(t,e,r){n.push({path:t,element:e,parent:r})},setBaseUrl:function(t){e=t},currentPath:i,apply:o,setRouteEl:function(t,n){return"A"===t.tagName&&(t.href=n),t.addEventListener("click",function(t){t.preventDefault(),a(n)}),t},push:a},c=window.__cache||[],s=[],f=1e5;function d(t,n,e){return void 0===e&&(e=f),new Promise(function(r){var i=c.find(function(n){return n.url===t});i&&Date.now()-e<i.time?r(n(i.data)):fetch(t).then(function(e){e.json().then(function(e){i?(i.data=e,i.time=Date.now()):c.push({url:t,data:e,time:Date.now()}),r(n(e))})})})}var l={__proto__:null,cache:c,setOptions:function(t){"number"==typeof t.refresh&&(f=t.refresh)},attach:function(t,n,e){void 0===e&&(e=f),s.push({url:t,func:n,refresh:e})},detach:function(t){var n=s.findIndex(function(n){return n.url===t});-1!==n&&s.splice(n,1)},apply:function(){var t=s.map(function(t){return d(t.url,t.func,t.refresh)});return Promise.all(t)},get:d};function p(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}var h={__proto__:null,replaceStringArgs:function(t,n){var e=t;return Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](),e=e.replace("{{"+t+"}}",n[t])}),e},applyValue:function t(n){if("function"==typeof n){var e=n();return t.apply(void 0,[e].concat([].slice.call(arguments,1)))}return n},emptyChilds:p},v=window.__ssr||[],y=[],m=0;function w(n,e){void 0===e&&(e={});var r=e.attrs,i=void 0===r?{}:r,o=e.events,a=void 0===o?{}:o,u=e.dataset,c=void 0===u?{}:u,s=e.classList,f=void 0===s?[]:s,d=e.value,l=e.html,p=e.updateKeys,h=null;if(window.isServer)(h=window.document.createElement(n)).__id=t(6),h.dataset.ssrId=h.__id,v.push({id:h.__id,i:m});else{var w=v.find(function(t){return t.i===m});w&&(h=window.document.querySelector('[data-ssr-id="'+w.id+'"]'))&&(h.__id=w.id),h||((h=window.document.createElement(n)).__id=t(6))}return Object.keys(i).forEach(function(t){return h.setAttribute(t,i[t])}),"string"==typeof f?h.classList.add(f):Array.isArray(f)&&f.forEach(function(t){return h.classList.add(t)}),Object.keys(c).forEach(function(t){return h.dataset[t]=c[t]}),Object.keys(a).forEach(function(t){return h.addEventListener(t,a[t])}),p&&O(p,h),y.push({el:h,value:d,html:l}),m++,A(h),h}function _(t,n,e){return void 0===e&&(e="div"),w(e,{classList:t,value:n})}var E=["INPUT","TEXTAREA"];function A(t,n,e){var r=y.find(function(n){return n.el.__id===t.__id});n&&(r.value=n,n&&(r.html=e)),function t(n,e,r){if(e)if("function"!=typeof e){if("object"==typeof e)return p(n),void(Array.isArray(e)?e.forEach(function(t){return n.append(t)}):n.append(e));-1===E.indexOf(n.tagName)?r?n.innerHTML=e:n.textContent=e:n.value=e}else{var i=e(n);i&&t(n,i,r)}}(t,r.value,r.html)}var S=[],g={};function O(t,n){Array.isArray(t)?t.forEach(function(t){return O(t,n)}):Array.isArray(n)?n.forEach(function(n){return O(t,n)}):S.push({key:t,el:n})}function b(t,n){g[t]={updateFunc:n}}function j(t,n){var e=n,r=g[t];r&&(e=r.updateFunc),S.filter(function(n){return n.key===t}).forEach(function(t){var n=t.el;"function"==typeof e?e(n):A(n)})}var L=window.Element,k=L.prototype.append;L.prototype.append=function(){k.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var x=L.prototype.appendChild;L.prototype.appendChild=function(){arguments.parentElement||x.apply(this,arguments)};var C=function(t){var n=t.src,e=w("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=w("script",{attrs:{src:n},useSSR:!1}),i=w("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(v),useSSR:!1}),o=w("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return A(o,"window.__cache = "+JSON.stringify(c)),console.log(i.parentElement),t.head.append(e),t.body.append(i,o,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{C as SSR,l as fetcher,h as helpers,w as newEl,_ as newElClass,u as router,O as setElKey,j as update,A as updateEl,b as updateSet};
//# sourceMappingURL=domerjs.module.js.map
