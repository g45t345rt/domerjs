import{nanoid as t}from"nanoid";var n=[],e="",r=function(t,n){return Array.isArray(t)?-1!==t.indexOf(n):t===n};function o(){return window.location.pathname.replace(e,"")}function i(){var t=o(),e=n.every(function(n){return!r(n.path,t)});n.forEach(function(n){var o=n.path,i=n.element,a=n.parent,u=void 0===a?window.document.body:a;r(o,t)||e&&r(o,"")?u.append(i):u.contains(i)&&i.remove()})}function a(t){var n=""+e+t;window.history.pushState({path:n},"",n),i();var r=t.indexOf("#");if(-1!==r){var o=t.substring(r+1),a=window.document.getElementById(o);a&&window.scrollTo(0,a.offsetTop)}}window.addEventListener("popstate",function(){return i()});var u={__proto__:null,set:function(t,e,r){n.push({path:t,element:e,parent:r})},setBaseUrl:function(t){e=t},currentPath:o,apply:i,setRouteEl:function(t,n){return"A"===t.tagName&&(t.href=n),t.addEventListener("click",function(t){t.preventDefault(),a(n)}),t},push:a},c=window.__cache||[],s=[],f=1e5;function p(t,n,e){return void 0===e&&(e=f),new Promise(function(r){var o=c.find(function(n){return n.url===t});o&&Date.now()-e<o.time?r(n(o.data)):fetch(t).then(function(e){e.json().then(function(e){o?(o.data=e,o.time=Date.now()):c.push({url:t,data:e,time:Date.now()}),r(n(e))})})})}var d={__proto__:null,cache:c,setOptions:function(t){"number"==typeof t.refresh&&(f=t.refresh)},attach:function(t,n,e){void 0===e&&(e=f),s.push({url:t,func:n,refresh:e})},detach:function(t){var n=s.findIndex(function(n){return n.url===t});-1!==n&&s.splice(n,1)},apply:function(){var t=s.map(function(t){return p(t.url,t.func,t.refresh)});return Promise.all(t)},get:p};function l(){return(l=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)}function v(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}var h={__proto__:null,replaceStringArgs:function(t,n){var e=t;return Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](),e=e.replace("{{"+t+"}}",n[t])}),e},applyValue:function t(n){if("function"==typeof n){var e=n();return t.apply(void 0,[e].concat([].slice.call(arguments,1)))}return n},emptyChilds:v},y=window.__ssr||[],_=[],w=0;function m(n,e){void 0===e&&(e={});var r=e.attrs,o=void 0===r?{}:r,i=e.events,a=void 0===i?{}:i,u=e.dataset,c=void 0===u?{}:u,s=e.classList,f=void 0===s?[]:s,p=e.updateOn,d=null;if(window.isServer)(d=window.document.createElement(n)).__id=t(6),d.dataset.ssrId=d.__id,y.push({id:d.__id,i:w});else{var l=y.find(function(t){return t.i===w});l&&(d=window.document.querySelector('[data-ssr-id="'+l.id+'"]'))&&(d.__id=l.id),d||((d=window.document.createElement(n)).__id=t(6))}return _.push({el:d,options:e}),w++,g(d),Object.keys(o).forEach(function(t){return d.setAttribute(t,o[t])}),"string"==typeof f?d.classList.add(f):Array.isArray(f)&&f.forEach(function(t){return d.classList.add(t)}),Object.keys(c).forEach(function(t){return d.dataset[t]=c[t]}),Object.keys(a).forEach(function(t){return d.addEventListener(t,a[t])}),p&&j(p,d),d}function E(t,n,e){return void 0===e&&(e="div"),m(e,{classList:t,value:n})}function A(t,n){void 0===n&&(n=!1);var e=function(t,n){return t.__id===n.__id};if(n)return _.findIndex(function(n){return e(n.el,t)});var r=_.find(function(n){return e(n.el,t)});return r?r.options:void 0}var S=["INPUT","TEXTAREA"];function g(t,n){n&&function(t,n){var e=A(t,!0);-1!==e&&(_[e].options=l({},_[e].options,n))}(t,n);var e=A(t);!function t(n,e,r){if(e)if("function"!=typeof e){if("object"==typeof e)return v(n),void(Array.isArray(e)?e.forEach(function(t){return n.append(t)}):n.append(e));-1===S.indexOf(n.tagName)?r?n.innerHTML=e:n.textContent=e:n.value=e}else{var o=e(n);o&&t(n,o,r)}}(t,e.value,e.html)}var O=[],b={};function j(t,n){Array.isArray(t)?t.forEach(function(t){return j(t,n)}):Array.isArray(n)?n.forEach(function(n){return j(t,n)}):O.push({key:t,el:n})}var x={__proto__:null,assign:j,set:function(t,n){b[t]={updateFunc:n}},apply:function(t,n){var e=n,r=b[t];r&&(e=r.updateFunc),O.filter(function(n){return n.key===t}).forEach(function(t){var n=t.el;"function"==typeof e?e(n):g(n)})}},L=window.Element,k=L.prototype.append;L.prototype.append=function(){k.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var C=L.prototype.appendChild;L.prototype.appendChild=function(){arguments.parentElement||C.apply(this,arguments)};var T=function(t){var n=t.src,e=m("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=m("script",{attrs:{src:n},useSSR:!1}),o=m("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(y),useSSR:!1}),i=m("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return g(i,"window.__cache = "+JSON.stringify(c)),console.log(o.parentElement),t.head.append(e),t.body.append(o,i,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{T as SSR,d as fetcher,h as helpers,m as newEl,E as newElClass,u as router,g as updateEl,x as updater};
//# sourceMappingURL=domerjs.module.js.map
