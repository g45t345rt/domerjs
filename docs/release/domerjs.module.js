import{nanoid as t}from"nanoid";var n=[];function e(){var t=window.location.pathname,e=function(t,n){return Array.isArray(t)?-1!==t.indexOf(n):t===n},r=n.every(function(n){return!e(n.path,t)});n.forEach(function(n){var o=n.path,i=n.element,a=n.parent,u=void 0===a?window.document.body:a;e(o,t)||r&&e(o,"")?u.append(i):u.contains(i)&&i.remove()})}function r(t){var n=""+t;window.history.pushState({path:n},"",n),e();var r=t.indexOf("#");if(-1!==r){var o=t.substring(r+1),i=window.document.getElementById(o);i&&window.scrollTo(0,i.offsetTop)}}window.addEventListener("popstate",function(){return e()});var o={__proto__:null,set:function(t,e,r){n.push({path:t,element:e,parent:r})},apply:e,setRouteEl:function(t,n){return"A"===t.tagName&&(t.href=n),t.addEventListener("click",function(t){t.preventDefault(),r(n)}),t},push:r},i=window.__cache||[],a=[],u=1e5;function c(t,n,e){return void 0===e&&(e=u),new Promise(function(r){var o=i.find(function(n){return n.url===t});o&&Date.now()-e<o.time?r(n(o.data)):fetch(t).then(function(e){e.json().then(function(e){o?(o.data=e,o.time=Date.now()):i.push({url:t,data:e,time:Date.now()}),r(n(e))})})})}var s={__proto__:null,cache:i,setOptions:function(t){"number"==typeof t.refresh&&(u=t.refresh)},attach:function(t,n,e){void 0===e&&(e=u),a.push({url:t,func:n,refresh:e})},detach:function(t){var n=a.findIndex(function(n){return n.url===t});-1!==n&&a.splice(n,1)},apply:function(){var t=a.map(function(t){return c(t.url,t.func,t.refresh)});return Promise.all(t)},get:c},f=window.__ssr||[],d=0;function p(n,e){void 0===e&&(e={});var r=null,o=e.attrs,i=void 0===o?{}:o,a=e.events,u=void 0===a?{}:a,c=e.dataset,s=void 0===c?{}:c,p=e.classList,l=void 0===p?[]:p,v=e.value,y=e.html,m=e.updateOn,E=e.useSSR,_=void 0===E||E,S={};if(_&&window.isServer)(r=window.document.createElement(n)).id=t(5),f.push({id:r.id,i:d});else{var g=f.find(function(t){return t.i===d});g&&(r=window.document.getElementById(g.id)),r||(r=window.document.createElement(n))}return window.isServer&&!_&&(S.append=!1),d++,S.render={value:v,html:y},r.data=S,h(r),Object.keys(i).forEach(function(t){return r.setAttribute(t,i[t])}),"string"==typeof l?r.classList.add(l):Array.isArray(l)&&l.forEach(function(t){return r.classList.add(t)}),Object.keys(s).forEach(function(t){return r.dataset[t]=s[t]}),Object.keys(u).forEach(function(t){return r.addEventListener(t,u[t])}),m&&w(m,r),r}function l(t,n,e){return void 0===e&&(e="div"),p(e,{classList:t,value:n})}var v=["INPUT","TEXTAREA"];function h(t,n){var e=t.data.render,r=e.value,o=e.html;if(n&&(r=n),r)if("function"!=typeof r)-1===v.indexOf(t.tagName)?o?t.innerHTML=r:t.textContent=r:t.value=r;else{var i=r(t);i&&h(t,i)}}var y=[],m={};function w(t,n){Array.isArray(t)?t.forEach(function(t){return w(t,n)}):Array.isArray(n)?n.forEach(function(n){return w(t,n)}):y.push({key:t,el:n})}var E={__proto__:null,assign:w,set:function(t,n){m[t]={updateFunc:n}},apply:function(t,n){var e=n,r=m[t];r&&(e=r.updateFunc),y.filter(function(n){return n.key===t}).forEach(function(t){var n=t.el;"function"==typeof e?e(n):h(n)})}},_={__proto__:null,replaceStringArgs:function(t,n){var e=t;return Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](),e=e.replace("{{"+t+"}}",n[t])}),e},applyValue:function t(n){if("function"==typeof n){var e=n();return t.apply(void 0,[e].concat([].slice.call(arguments,1)))}return n},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}},S=window.Element,g=S.prototype.append;S.prototype.append=function(){g.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var A=S.prototype.appendChild;S.prototype.appendChild=function(){arguments.parentElement||A.apply(this,arguments)};var O=function(t){var n=t.src,e=p("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=p("script",{attrs:{src:n},useSSR:!1}),o=p("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(f),useSSR:!1}),a=p("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return h(a,"window.__cache = "+JSON.stringify(i)),console.log(o.parentElement),t.head.append(e),t.body.append(o,a,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{O as SSR,s as fetcher,_ as helpers,p as newEl,l as newElClass,o as router,h as updateEl,E as updater};
//# sourceMappingURL=domerjs.module.js.map
