import{nanoid as t}from"nanoid";var n=[],e=window.document.body;function r(t){void 0===t&&(t={i:0,routeFound:!1,lock:[]});var o=e,i=t.i;if(!(i>n.length-1)){var a=n[i],u=a.path,c=a.el,s=a.parent;if(u===window.location.pathname||t.updateEmpty?(t.routeFound=!0,o.isEqualNode(s)||(t.lock.push(s),o.contains(s)||o.append(s)),t.lock.push(c),s.contains(c)||(s.append(c),c.dispatchEvent(new window.Event("routeAttach")))):(!t.lock.some(function(t){return c.isEqualNode(t)})&&s.contains(c)&&(c.remove(),c.dispatchEvent(new window.Event("routeDetach"))),t.lock.some(function(t){return s.isEqualNode(t)})||o.isEqualNode(s)||!o.contains(s)||o.removeChild(s)),""===u){var p=n[i+1];p&&""!==p.path?(n.splice(i,1),n.push(a),t.i--):t.routeFound||(t.updateEmpty=!0,t.i--)}t.i++,r(t)}}function o(t){var n=""+t;window.history.pushState({path:n},"",n),r();var e=t.indexOf("#");if(-1!==e){var o=t.substring(e+1),i=window.document.getElementById(o);i&&window.scrollTo(0,i.offsetTop)}}window.addEventListener("popstate",function(){r()});var i={__proto__:null,setRoot:function(t){e=t},assign:function t(r,o,i){void 0===i&&(i=e),Array.isArray(r)?r.forEach(function(n){return t(n,o,i)}):n.push({el:o,path:r,parent:i})},setRouteEl:function(t,n){return"A"===t.tagName&&(t.href=n),t.addEventListener("click",function(t){t.preventDefault(),o(n)}),t},push:o,apply:function(){r()}},a=window.__cache||[],u=[],c=1e5;function s(t,n,e){return void 0===e&&(e=c),new Promise(function(r){var o=a.find(function(n){return n.url===t});o&&Date.now()-e<o.time?r(n(o.data)):fetch(t).then(function(e){e.json().then(function(e){o?(o.data=e,o.time=Date.now()):a.push({url:t,data:e,time:Date.now()}),r(n(e))})})})}var p={__proto__:null,cache:a,setOptions:function(t){"number"==typeof t.refresh&&(c=t.refresh)},attach:function(t,n,e){void 0===e&&(e=c),u.push({url:t,func:n,refresh:e})},detach:function(t){var n=u.findIndex(function(n){return n.url===t});-1!==n&&u.splice(n,1)},apply:function(){var t=u.map(function(t){return s(t.url,t.func,t.refresh)});return Promise.all(t)},get:s},d=window.__ssr||[],l=0;function f(n,e){void 0===e&&(e={});var r=null,o=e.attrs,i=void 0===o?{}:o,a=e.events,u=void 0===a?{}:a,c=e.dataset,s=void 0===c?{}:c,p=e.value,f=e.html,h=e.updateOn,w=e.useSSR,y=void 0===w||w,m={};if(y&&window.isServer)(r=window.document.createElement(n)).id=t(5),d.push({id:r.id,i:l});else{var E=d.find(function(t){return t.i===l});E&&(r=window.document.getElementById(E.id)),r||(r=window.document.createElement(n))}return window.isServer&&!y&&(m.append=!1),l++,m.render={value:p,html:f},r.data=m,v(r),Object.keys(i).forEach(function(t){return r.setAttribute(t,i[t])}),Object.keys(s).forEach(function(t){return r.dataset[t]=s[t]}),Object.keys(u).forEach(function(t){return r.addEventListener(t,u[t])}),h&&updater.assign(h,r),r}var h=["INPUT","TEXTAREA"];function v(t,n){var e=t.data.render,r=e.value,o=e.html;n&&(r=n),r&&("function"!=typeof r?-1===h.indexOf(t.tagName)?o?t.innerHTML=r:t.textContent=r:t.value=r:v(t,r(t)))}var w=[],y={},m={__proto__:null,assign:function t(n,e){Array.isArray(n)?n.forEach(function(n){return t(n,e)}):Array.isArray(e)?e.forEach(function(e){return t(n,e)}):w.push({key:n,el:e})},set:function(t,n){y[t]={updateFunc:n}},apply:function(t,n){var e=n,r=y[t];r&&(e=r.updateFunc),w.filter(function(n){return n.key===t}).forEach(function(t){var n=t.el;"function"==typeof e?e(n):v(n)})}},E={__proto__:null,replaceStringArgs:function(t,n){var e=t;return Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](),e=e.replace("{{"+t+"}}",n[t])}),e},applyValue:function t(n){if("function"==typeof n){var e=n();return t.apply(void 0,[e].concat([].slice.call(arguments,1)))}return n},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}},_=window.Element,S=_.prototype.append;_.prototype.append=function(){S.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var g=_.prototype.appendChild;_.prototype.appendChild=function(){arguments.parentElement||g.apply(this,arguments)};var k=function(t){var n=t.src,e=f("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=f("script",{attrs:{src:n},useSSR:!1}),o=f("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(d),useSSR:!1}),i=f("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return v(i,"window.__cache = "+JSON.stringify(a)),console.log(o.parentElement),t.head.append(e),t.body.append(o,i,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{k as SSR,p as fetcher,E as helpers,f as newEl,i as router,v as updateEl,m as updater};
//# sourceMappingURL=domerjs.module.js.map
