!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("nanoid")):"function"==typeof define&&define.amd?define(["exports","nanoid"],e):e((t=t||self).domerjs={},t.nanoid)}(this,function(t,e){var n=[],r="",o=function(t,e){return Array.isArray(t)?-1!==t.indexOf(e):t===e};function i(){return window.location.pathname.replace(r,"")}function a(){var t=i(),e=n.every(function(e){return!o(e.path,t)});n.forEach(function(n){var r=n.path,i=n.element,a=n.parent,u=void 0===a?window.document.body:a;o(r,t)||e&&o(r,"")?u.append(i):u.contains(i)&&i.remove()})}function u(t){var e=""+r+t;window.history.pushState({path:e},"",e),a();var n=t.indexOf("#");if(-1!==n){var o=t.substring(n+1),i=window.document.getElementById(o);i&&window.scrollTo(0,i.offsetTop)}}window.addEventListener("popstate",function(){return a()});var c={__proto__:null,set:function(t,e,r){n.push({path:t,element:e,parent:r})},setBaseUrl:function(t){r=t},currentPath:i,apply:a,setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",function(t){t.preventDefault(),u(e)}),t},push:u},s=window.__cache||[],f=[],d=1e5;function l(t,e,n){return void 0===n&&(n=d),new Promise(function(r){var o=s.find(function(e){return e.url===t});o&&Date.now()-n<o.time?r(e(o.data)):fetch(t).then(function(n){n.json().then(function(n){o?(o.data=n,o.time=Date.now()):s.push({url:t,data:n,time:Date.now()}),r(e(n))})})})}var p={__proto__:null,cache:s,setOptions:function(t){"number"==typeof t.refresh&&(d=t.refresh)},attach:function(t,e,n){void 0===n&&(n=d),f.push({url:t,func:e,refresh:n})},detach:function(t){var e=f.findIndex(function(e){return e.url===t});-1!==e&&f.splice(e,1)},apply:function(){var t=f.map(function(t){return l(t.url,t.func,t.refresh)});return Promise.all(t)},get:l};function h(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}var v={__proto__:null,replaceStringArgs:function(t,e){var n=t;return Object.keys(e).forEach(function(t){"function"==typeof e[t]&&e[t](),n=n.replace("{{"+t+"}}",e[t])}),n},applyValue:function t(e){if("function"==typeof e){var n=e();return t.apply(void 0,[n].concat([].slice.call(arguments,1)))}return e},emptyChilds:h},y=window.__ssr||[],m=[],w=0;function _(t,n){void 0===n&&(n={});var r=n.attrs,o=void 0===r?{}:r,i=n.events,a=void 0===i?{}:i,u=n.dataset,c=void 0===u?{}:u,s=n.classList,f=void 0===s?[]:s,d=n.value,l=n.html,p=n.updateKeys,h=null;if(window.isServer)(h=window.document.createElement(t)).__id=e.nanoid(6),h.dataset.ssrId=h.__id,y.push({id:h.__id,i:w});else{var v=y.find(function(t){return t.i===w});v&&(h=window.document.querySelector('[data-ssr-id="'+v.id+'"]'))&&(h.__id=v.id),h||((h=window.document.createElement(t)).__id=e.nanoid(6))}return Object.keys(o).forEach(function(t){return h.setAttribute(t,o[t])}),"string"==typeof f?h.classList.add(f):Array.isArray(f)&&f.forEach(function(t){return h.classList.add(t)}),Object.keys(c).forEach(function(t){return h.dataset[t]=c[t]}),Object.keys(a).forEach(function(t){return h.addEventListener(t,a[t])}),p&&b(p,h),m.push({el:h,value:d,html:l}),w++,S(h),h}var E=["INPUT","TEXTAREA"];function S(t,e,n){var r=m.find(function(e){return e.el.__id===t.__id});e&&(r.value=e,e&&(r.html=n)),function t(e,n,r){if(n)if("function"!=typeof n){if("object"==typeof n)return h(e),void(Array.isArray(n)?n.forEach(function(t){return e.append(t)}):e.append(n));-1===E.indexOf(e.tagName)?r?e.innerHTML=n:e.textContent=n:e.value=n}else{var o=n(e);o&&t(e,o,r)}}(t,r.value,r.html)}var A=[],g={};function b(t,e){Array.isArray(t)?t.forEach(function(t){return b(t,e)}):Array.isArray(e)?e.forEach(function(e){return b(t,e)}):A.push({key:t,el:e})}var j=window.Element,O=j.prototype.append;j.prototype.append=function(){O.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var x=j.prototype.appendChild;j.prototype.appendChild=function(){arguments.parentElement||x.apply(this,arguments)},t.SSR=function(t){var e=t.src,n=_("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=_("script",{attrs:{src:e},useSSR:!1}),o=_("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(y),useSSR:!1}),i=_("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return S(i,"window.__cache = "+JSON.stringify(s)),console.log(o.parentElement),t.head.append(n),t.body.append(o,i,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}},t.fetcher=p,t.helpers=v,t.newEl=_,t.newElClass=function(t,e,n){return void 0===n&&(n="div"),_(n,{classList:t,value:e})},t.router=c,t.setElKey=b,t.update=function(t,e){var n=e,r=g[t];r&&(n=r.updateFunc),A.filter(function(e){return e.key===t}).forEach(function(t){var e=t.el;"function"==typeof n?n(e):S(e)})},t.updateEl=S,t.updateSet=function(t,e){g[t]={updateFunc:e}}});
//# sourceMappingURL=domerjs.umd.js.map
