!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("nanoid")):"function"==typeof define&&define.amd?define(["exports","nanoid"],e):e((t=t||self).domerjs={},t.nanoid)}(this,function(t,e){var n=[],r=window.document.body;function o(t){void 0===t&&(t={i:0,routeFound:!1,lock:[]});var e=r,i=t.i;if(!(i>n.length-1)){var a=n[i],u=a.path,c=a.el,d=a.parent;if(u===window.location.pathname||t.updateEmpty?(t.routeFound=!0,e.isEqualNode(d)||(t.lock.push(d),e.contains(d)||e.append(d)),t.lock.push(c),d.contains(c)||(d.append(c),c.dispatchEvent(new window.Event("routeAttach")))):(!t.lock.some(function(t){return c.isEqualNode(t)})&&d.contains(c)&&(c.remove(),c.dispatchEvent(new window.Event("routeDetach"))),t.lock.some(function(t){return d.isEqualNode(t)})||e.isEqualNode(d)||!e.contains(d)||e.removeChild(d)),""===u){var s=n[i+1];s&&""!==s.path?(n.splice(i,1),n.push(a),t.i--):t.routeFound||(t.updateEmpty=!0,t.i--)}t.i++,o(t)}}function i(t){var e=""+t;window.history.pushState({path:e},"",e),o();var n=t.indexOf("#");if(-1!==n){var r=t.substring(n+1),i=window.document.getElementById(r);i&&window.scrollTo(0,i.offsetTop)}}window.addEventListener("popstate",function(){o()});var a={__proto__:null,setRoot:function(t){r=t},assign:function t(e,o,i){void 0===i&&(i=r),Array.isArray(e)?e.forEach(function(e){return t(e,o,i)}):n.push({el:o,path:e,parent:i})},setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",function(t){t.preventDefault(),i(e)}),t},push:i,apply:function(){o()}},u=window.__cache||[],c=[],d=1e5;function s(t,e,n){return void 0===n&&(n=d),new Promise(function(r){var o=u.find(function(e){return e.url===t});o&&Date.now()-n<o.time?r(e(o.data)):fetch(t).then(function(n){n.json().then(function(n){o?(o.data=n,o.time=Date.now()):u.push({url:t,data:n,time:Date.now()}),r(e(n))})})})}var p={__proto__:null,cache:u,setOptions:function(t){"number"==typeof t.refresh&&(d=t.refresh)},attach:function(t,e,n){void 0===n&&(n=d),c.push({url:t,func:e,refresh:n})},detach:function(t){var e=c.findIndex(function(e){return e.url===t});-1!==e&&c.splice(e,1)},apply:function(){var t=c.map(function(t){return s(t.url,t.func,t.refresh)});return Promise.all(t)},get:s},f=window.__ssr||[],l=0;function h(t,n){void 0===n&&(n={});var r=null,o=n.attrs,i=void 0===o?{}:o,a=n.events,u=void 0===a?{}:a,c=n.dataset,d=void 0===c?{}:c,s=n.value,p=n.html,h=n.updateOn,v=n.useSSR,w=void 0===v||v,m={};if(w&&window.isServer)(r=window.document.createElement(t)).id=e.nanoid(5),f.push({id:r.id,i:l});else{var E=f.find(function(t){return t.i===l});E&&(r=window.document.getElementById(E.id)),r||(r=window.document.createElement(t))}return window.isServer&&!w&&(m.append=!1),l++,m.render={value:s,html:p},r.data=m,y(r),Object.keys(i).forEach(function(t){return r.setAttribute(t,i[t])}),Object.keys(d).forEach(function(t){return r.dataset[t]=d[t]}),Object.keys(u).forEach(function(t){return r.addEventListener(t,u[t])}),h&&updater.assign(h,r),r}var v=["INPUT","TEXTAREA"];function y(t,e){var n=t.data.render,r=n.value,o=n.html;e&&(r=e),r&&("function"!=typeof r?-1===v.indexOf(t.tagName)?o?t.innerHTML=r:t.textContent=r:t.value=r:y(t,r(t)))}var w=[],m={},E={__proto__:null,assign:function t(e,n){Array.isArray(e)?e.forEach(function(e){return t(e,n)}):Array.isArray(n)?n.forEach(function(n){return t(e,n)}):w.push({key:e,el:n})},set:function(t,e){m[t]={updateFunc:e}},apply:function(t,e){var n=e,r=m[t];r&&(n=r.updateFunc),w.filter(function(e){return e.key===t}).forEach(function(t){var e=t.el;"function"==typeof n?n(e):y(e)})}},_={__proto__:null,replaceStringArgs:function(t,e){var n=t;return Object.keys(e).forEach(function(t){"function"==typeof e[t]&&e[t](),n=n.replace("{{"+t+"}}",e[t])}),n},applyValue:function t(e){if("function"==typeof e){var n=e();return t.apply(void 0,[n].concat([].slice.call(arguments,1)))}return e},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}},S=window.Element,g=S.prototype.append;S.prototype.append=function(){g.apply(this,Array.prototype.slice.call(arguments).filter(function(t){return!t.parentElement}))};var k=S.prototype.appendChild;S.prototype.appendChild=function(){arguments.parentElement||k.apply(this,arguments)},t.SSR=function(t){var e=t.src,n=h("link",{attrs:{rel:"stylesheet",href:t.stylesheet},useSSR:!1}),r=h("script",{attrs:{src:e},useSSR:!1}),o=h("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(f),useSSR:!1}),i=h("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:function(t){return jsdom.reconfigure({url:"http://localhost"+t})},toHtml:function(){var t=window.document;return y(i,"window.__cache = "+JSON.stringify(u)),console.log(o.parentElement),t.head.append(n),t.body.append(o,i,r),"<!DOCTYPE html>"+t.documentElement.outerHTML}}},t.fetcher=p,t.helpers=_,t.newEl=h,t.router=a,t.updateEl=y,t.updater=E});
//# sourceMappingURL=domerjs.umd.js.map
