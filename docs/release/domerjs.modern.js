import{nanoid as t}from"nanoid";const e=[];function n(){const t=window.location.pathname,n=(t,e)=>Array.isArray(t)?-1!==t.indexOf(e):t===e,o=e.every(({path:e})=>!n(e,t));e.forEach(e=>{const{path:r,element:s,parent:a=window.document.body}=e;n(r,t)||o&&n(r,"")?a.append(s):a.contains(s)&&s.remove()})}function o(t){const e=""+t;window.history.pushState({path:e},"",e),n();const o=t.indexOf("#");if(-1!==o){const e=t.substring(o+1),n=window.document.getElementById(e);n&&window.scrollTo(0,n.offsetTop)}}window.addEventListener("popstate",()=>n());var r={__proto__:null,set:function(t,n,o){e.push({path:t,element:n,parent:o})},apply:n,setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",t=>{t.preventDefault(),o(e)}),t},push:o};const s=window.__cache||[],a=[];let i=1e5;function c(t,e,n=i){return new Promise(o=>{const r=s.find(e=>e.url===t);r&&Date.now()-n<r.time?o(e(r.data)):fetch(t).then(n=>{n.json().then(n=>{r?(r.data=n,r.time=Date.now()):s.push({url:t,data:n,time:Date.now()}),o(e(n))})})})}var l={__proto__:null,cache:s,setOptions:function(t){"number"==typeof t.refresh&&(i=t.refresh)},attach:function(t,e,n=i){a.push({url:t,func:e,refresh:n})},detach:function(t){const e=a.findIndex(e=>e.url===t);-1!==e&&a.splice(e,1)},apply:function(){const t=a.map(({url:t,func:e,refresh:n})=>c(t,e,n));return Promise.all(t)},get:c};let p=window.__ssr||[],u=0;function d(e,n={}){let o=null;const{attrs:r={},events:s={},dataset:a={},classList:i=[],value:c,html:l,updateOn:d,useSSR:f=!0}=n;let h={};if(f&&window.isServer)o=window.document.createElement(e),o.id=t(5),p.push({id:o.id,i:u});else{const t=p.find(({i:t})=>t===u);t&&(o=window.document.getElementById(t.id)),o||(o=window.document.createElement(e))}return window.isServer&&!f&&(h.append=!1),u++,h.render={value:c,html:l},o.data=h,y(o),Object.keys(r).forEach(t=>o.setAttribute(t,r[t])),"string"==typeof i?o.classList.add(i):Array.isArray(i)&&i.forEach(t=>o.classList.add(t)),Object.keys(a).forEach(t=>o.dataset[t]=a[t]),Object.keys(s).forEach(t=>o.addEventListener(t,s[t])),d&&E(d,o),o}function f(t,e,n="div"){return d(n,{classList:t,value:e})}const h=["INPUT","TEXTAREA"];function y(t,e){let{value:n,html:o}=t.data.render;if(e&&(n=e),n)if("function"!=typeof n)-1===h.indexOf(t.tagName)?o?t.innerHTML=n:t.textContent=n:t.value=n;else{const e=n(t);e&&y(t,e)}}const m=[],w={};function E(t,e){Array.isArray(t)?t.forEach(t=>E(t,e)):Array.isArray(e)?e.forEach(e=>E(t,e)):m.push({key:t,el:e})}var _={__proto__:null,assign:E,set:function(t,e){w[t]={updateFunc:e}},apply:function(t,e){let n=e;const o=w[t];o&&(n=o.updateFunc),m.filter(e=>e.key===t).forEach(({el:t})=>{"function"==typeof n?n(t):y(t)})}},v={__proto__:null,replaceStringArgs:function(t,e){let n=t;return Object.keys(e).forEach(t=>{let o="";o="function"==typeof e[t]?e[t]():e[t],n=n.replace(`{{${t}}}`,e[t])}),n},applyValue:function t(e,...n){return"function"==typeof e?t(e(),...n):e},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}};const{Element:S}=window,g=S.prototype.append;S.prototype.append=function(){g.apply(this,[...arguments].filter(t=>!t.parentElement))};const A=S.prototype.appendChild;S.prototype.appendChild=function(){arguments.parentElement||A.apply(this,arguments)};var O=t=>{const{src:e,stylesheet:n,baseUrl:o="http://localhost"}=t,r=d("link",{attrs:{rel:"stylesheet",href:n},useSSR:!1}),a=d("script",{attrs:{src:e},useSSR:!1}),i=d("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(p),useSSR:!1}),c=d("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:t=>jsdom.reconfigure({url:"http://localhost"+t}),toHtml(){const{document:t}=window;return y(c,"window.__cache = "+JSON.stringify(s)),console.log(i.parentElement),t.head.append(r),t.body.append(i,c,a),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{O as SSR,l as fetcher,v as helpers,d as newEl,f as newElClass,r as router,y as updateEl,_ as updater};
//# sourceMappingURL=domerjs.modern.js.map
