import{nanoid as t}from"nanoid";const e=[];let n="";const o=(t,e)=>Array.isArray(t)?-1!==t.indexOf(e):t===e;function r(){return window.location.pathname.replace(n,"")}function s(){const t=r(),n=e.every(({path:e})=>!o(e,t));e.forEach(e=>{const{path:r,element:s,parent:a=window.document.body}=e;o(r,t)||n&&o(r,"")?a.append(s):a.contains(s)&&s.remove()})}function a(t){const e=`${n}${t}`;window.history.pushState({path:e},"",e),s();const o=t.indexOf("#");if(-1!==o){const e=t.substring(o+1),n=window.document.getElementById(e);n&&window.scrollTo(0,n.offsetTop)}}window.addEventListener("popstate",()=>s());var i={__proto__:null,set:function(t,n,o){e.push({path:t,element:n,parent:o})},setBaseUrl:function(t){n=t},currentPath:r,apply:s,setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",t=>{t.preventDefault(),a(e)}),t},push:a};const c=window.__cache||[],l=[];let u=1e5;function p(t,e,n=u){return new Promise(o=>{const r=c.find(e=>e.url===t);r&&Date.now()-n<r.time?o(e(r.data)):fetch(t).then(n=>{n.json().then(n=>{r?(r.data=n,r.time=Date.now()):c.push({url:t,data:n,time:Date.now()}),o(e(n))})})})}var d={__proto__:null,cache:c,setOptions:function(t){"number"==typeof t.refresh&&(u=t.refresh)},attach:function(t,e,n=u){l.push({url:t,func:e,refresh:n})},detach:function(t){const e=l.findIndex(e=>e.url===t);-1!==e&&l.splice(e,1)},apply:function(){const t=l.map(({url:t,func:e,refresh:n})=>p(t,e,n));return Promise.all(t)},get:p};function f(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}var h={__proto__:null,replaceStringArgs:function(t,e){let n=t;return Object.keys(e).forEach(t=>{let o="";o="function"==typeof e[t]?e[t]():e[t],n=n.replace(`{{${t}}}`,e[t])}),n},applyValue:function t(e,...n){return"function"==typeof e?t(e(),...n):e},emptyChilds:f};let y=window.__ssr||[];const m=[];let w=0;function _(e,n={}){const{attrs:o={},events:r={},dataset:s={},classList:a=[],value:i,html:c,updateKeys:l}=n;let u=null;if(window.isServer)u=window.document.createElement(e),u.__id=t(6),u.dataset.ssrId=u.__id,y.push({id:u.__id,i:w});else{const n=y.find(({i:t})=>t===w);n&&(u=window.document.querySelector(`[data-ssr-id="${n.id}"]`),u&&(u.__id=n.id)),u||(u=window.document.createElement(e),u.__id=t(6))}return Object.keys(o).forEach(t=>u.setAttribute(t,o[t])),"string"==typeof a?u.classList.add(a):Array.isArray(a)&&a.forEach(t=>u.classList.add(t)),Object.keys(s).forEach(t=>u.dataset[t]=s[t]),Object.keys(r).forEach(t=>u.addEventListener(t,r[t])),l&&b(l,u),m.push({el:u,value:i,html:c}),w++,S(u),u}function E(t,e,n="div"){return _(n,{classList:t,value:e})}const v=["INPUT","TEXTAREA"];function S(t,e,n){const o=m.find(e=>e.el.__id===t.__id);e&&(o.value=e,e&&(o.html=n)),function t(e,n,o){if(n)if("function"!=typeof n){if("object"==typeof n)return f(e),void(Array.isArray(n)?n.forEach(t=>e.append(t)):e.append(n));-1===v.indexOf(e.tagName)?o?e.innerHTML=n:e.textContent=n:e.value=n}else{const r=n(e);r&&t(e,r,o)}}(t,o.value,o.html)}const A=[],g={};function b(t,e){Array.isArray(t)?t.forEach(t=>b(t,e)):Array.isArray(e)?e.forEach(e=>b(t,e)):A.push({key:t,el:e})}function O(t,e){g[t]={updateFunc:e}}function j(t,e){let n=e;const o=g[t];o&&(n=o.updateFunc),A.filter(e=>e.key===t).forEach(({el:t})=>{"function"==typeof n?n(t):S(t)})}const{Element:L}=window,k=L.prototype.append;L.prototype.append=function(){k.apply(this,[...arguments].filter(t=>!t.parentElement))};const x=L.prototype.appendChild;L.prototype.appendChild=function(){arguments.parentElement||x.apply(this,arguments)};var C=t=>{const{src:e,stylesheet:n,baseUrl:o="http://localhost"}=t,r=_("link",{attrs:{rel:"stylesheet",href:n},useSSR:!1}),s=_("script",{attrs:{src:e},useSSR:!1}),a=_("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(y),useSSR:!1}),i=_("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:t=>jsdom.reconfigure({url:"http://localhost"+t}),toHtml(){const{document:t}=window;return S(i,"window.__cache = "+JSON.stringify(c)),console.log(a.parentElement),t.head.append(r),t.body.append(a,i,s),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{C as SSR,d as fetcher,h as helpers,_ as newEl,E as newElClass,i as router,b as setElKey,j as update,S as updateEl,O as updateSet};
//# sourceMappingURL=domerjs.modern.js.map
