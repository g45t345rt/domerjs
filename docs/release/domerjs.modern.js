import{nanoid as t}from"nanoid";const e=[];let n="";const o=(t,e)=>Array.isArray(t)?-1!==t.indexOf(e):t===e;function r(){let t=window.location.pathname.replace(n,"");const r=e.every(({path:e})=>!o(e,t));e.forEach(e=>{const{path:n,element:s,parent:a=window.document.body}=e;o(n,t)||r&&o(n,"")?a.append(s):a.contains(s)&&s.remove()})}function s(t){const e=`${n}${t}`;window.history.pushState({path:e},"",e),r();const o=t.indexOf("#");if(-1!==o){const e=t.substring(o+1),n=window.document.getElementById(e);n&&window.scrollTo(0,n.offsetTop)}}window.addEventListener("popstate",()=>r());var a={__proto__:null,set:function(t,n,o){e.push({path:t,element:n,parent:o})},setBaseUrl:function(t){n=t},apply:r,setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",t=>{t.preventDefault(),s(e)}),t},push:s};const i=window.__cache||[],c=[];let l=1e5;function p(t,e,n=l){return new Promise(o=>{const r=i.find(e=>e.url===t);r&&Date.now()-n<r.time?o(e(r.data)):fetch(t).then(n=>{n.json().then(n=>{r?(r.data=n,r.time=Date.now()):i.push({url:t,data:n,time:Date.now()}),o(e(n))})})})}var u={__proto__:null,cache:i,setOptions:function(t){"number"==typeof t.refresh&&(l=t.refresh)},attach:function(t,e,n=l){c.push({url:t,func:e,refresh:n})},detach:function(t){const e=c.findIndex(e=>e.url===t);-1!==e&&c.splice(e,1)},apply:function(){const t=c.map(({url:t,func:e,refresh:n})=>p(t,e,n));return Promise.all(t)},get:p};let d=window.__ssr||[],f=0;function h(e,n={}){let o=null;const{attrs:r={},events:s={},dataset:a={},classList:i=[],value:c,html:l,updateOn:p,useSSR:u=!0}=n;let h={};if(u&&window.isServer)o=window.document.createElement(e),o.id=t(5),d.push({id:o.id,i:f});else{const t=d.find(({i:t})=>t===f);t&&(o=window.document.getElementById(t.id)),o||(o=window.document.createElement(e))}return window.isServer&&!u&&(h.append=!1),f++,h.render={value:c,html:l},o.data=h,w(o),Object.keys(r).forEach(t=>o.setAttribute(t,r[t])),"string"==typeof i?o.classList.add(i):Array.isArray(i)&&i.forEach(t=>o.classList.add(t)),Object.keys(a).forEach(t=>o.dataset[t]=a[t]),Object.keys(s).forEach(t=>o.addEventListener(t,s[t])),p&&v(p,o),o}function y(t,e,n="div"){return h(n,{classList:t,value:e})}const m=["INPUT","TEXTAREA"];function w(t,e){let{value:n,html:o}=t.data.render;if(e&&(n=e),n)if("function"!=typeof n)-1===m.indexOf(t.tagName)?o?t.innerHTML=n:t.textContent=n:t.value=n;else{const e=n(t);e&&w(t,e)}}const E=[],_={};function v(t,e){Array.isArray(t)?t.forEach(t=>v(t,e)):Array.isArray(e)?e.forEach(e=>v(t,e)):E.push({key:t,el:e})}var S={__proto__:null,assign:v,set:function(t,e){_[t]={updateFunc:e}},apply:function(t,e){let n=e;const o=_[t];o&&(n=o.updateFunc),E.filter(e=>e.key===t).forEach(({el:t})=>{"function"==typeof n?n(t):w(t)})}},g={__proto__:null,replaceStringArgs:function(t,e){let n=t;return Object.keys(e).forEach(t=>{let o="";o="function"==typeof e[t]?e[t]():e[t],n=n.replace(`{{${t}}}`,e[t])}),n},applyValue:function t(e,...n){return"function"==typeof e?t(e(),...n):e},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}};const{Element:A}=window,O=A.prototype.append;A.prototype.append=function(){O.apply(this,[...arguments].filter(t=>!t.parentElement))};const b=A.prototype.appendChild;A.prototype.appendChild=function(){arguments.parentElement||b.apply(this,arguments)};var L=t=>{const{src:e,stylesheet:n,baseUrl:o="http://localhost"}=t,r=h("link",{attrs:{rel:"stylesheet",href:n},useSSR:!1}),s=h("script",{attrs:{src:e},useSSR:!1}),a=h("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(d),useSSR:!1}),c=h("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:t=>jsdom.reconfigure({url:"http://localhost"+t}),toHtml(){const{document:t}=window;return w(c,"window.__cache = "+JSON.stringify(i)),console.log(a.parentElement),t.head.append(r),t.body.append(a,c,s),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{L as SSR,u as fetcher,g as helpers,h as newEl,y as newElClass,a as router,w as updateEl,S as updater};
//# sourceMappingURL=domerjs.modern.js.map
