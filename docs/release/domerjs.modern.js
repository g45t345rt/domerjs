import{nanoid as t}from"nanoid";const e=[];let n=window.document.body;function o(t={i:0,routeFound:!1,lock:[]}){const r=n,{i:a}=t;if(a>e.length-1)return;const s=e[a],{path:i,el:c,parent:u}=s;if(i===window.location.pathname||t.updateEmpty?(t.routeFound=!0,r.isEqualNode(u)||(t.lock.push(u),r.contains(u)||r.append(u)),t.lock.push(c),u.contains(c)||(u.append(c),c.dispatchEvent(new window.Event("routeAttach")))):(!t.lock.some(t=>c.isEqualNode(t))&&u.contains(c)&&(c.remove(),c.dispatchEvent(new window.Event("routeDetach"))),t.lock.some(t=>u.isEqualNode(t))||r.isEqualNode(u)||!r.contains(u)||r.removeChild(u)),""===i){const n=e[a+1];n&&""!==n.path?(e.splice(a,1),e.push(s),t.i--):t.routeFound||(t.updateEmpty=!0,t.i--)}t.i++,o(t)}function r(t){const e=""+t;window.history.pushState({path:e},"",e),o();const n=t.indexOf("#");if(-1!==n){const e=t.substring(n+1),o=window.document.getElementById(e);o&&window.scrollTo(0,o.offsetTop)}}window.addEventListener("popstate",function(){o()});var a={__proto__:null,setRoot:function(t){n=t},assign:function t(o,r,a=n){Array.isArray(o)?o.forEach(e=>t(e,r,a)):e.push({el:r,path:o,parent:a})},setRouteEl:function(t,e){return"A"===t.tagName&&(t.href=e),t.addEventListener("click",t=>{t.preventDefault(),r(e)}),t},push:r,apply:function(){o()}};const s=window.__cache||[],i=[];let c=1e5;function u(t,e,n=c){return new Promise(o=>{const r=s.find(e=>e.url===t);r&&Date.now()-n<r.time?o(e(r.data)):fetch(t).then(n=>{n.json().then(n=>{r?(r.data=n,r.time=Date.now()):s.push({url:t,data:n,time:Date.now()}),o(e(n))})})})}var l={__proto__:null,cache:s,setOptions:function(t){"number"==typeof t.refresh&&(c=t.refresh)},attach:function(t,e,n=c){i.push({url:t,func:e,refresh:n})},detach:function(t){const e=i.findIndex(e=>e.url===t);-1!==e&&i.splice(e,1)},apply:function(){const t=i.map(({url:t,func:e,refresh:n})=>u(t,e,n));return Promise.all(t)},get:u};let p=window.__ssr||[],d=0;function f(e,n={}){let o=null;const{attrs:r={},events:a={},dataset:s={},value:i,html:c,updateOn:u,useSSR:l=!0}=n;let f={};if(l&&window.isServer)o=window.document.createElement(e),o.id=t(5),p.push({id:o.id,i:d});else{const t=p.find(({i:t})=>t===d);t&&(o=window.document.getElementById(t.id)),o||(o=window.document.createElement(e))}return window.isServer&&!l&&(f.append=!1),d++,f.render={value:i,html:c},o.data=f,w(o),Object.keys(r).forEach(t=>o.setAttribute(t,r[t])),Object.keys(s).forEach(t=>o.dataset[t]=s[t]),Object.keys(a).forEach(t=>o.addEventListener(t,a[t])),u&&updater.assign(u,o),o}const h=["INPUT","TEXTAREA"];function w(t,e){let{value:n,html:o}=t.data.render;e&&(n=e),n&&("function"!=typeof n?-1===h.indexOf(t.tagName)?o?t.innerHTML=n:t.textContent=n:t.value=n:w(t,n(t)))}const m=[],y={};var E={__proto__:null,assign:function t(e,n){Array.isArray(e)?e.forEach(e=>t(e,n)):Array.isArray(n)?n.forEach(n=>t(e,n)):m.push({key:e,el:n})},set:function(t,e){y[t]={updateFunc:e}},apply:function(t,e){let n=e;const o=y[t];o&&(n=o.updateFunc),m.filter(e=>e.key===t).forEach(({el:t})=>{"function"==typeof n?n(t):w(t)})}},v={__proto__:null,replaceStringArgs:function(t,e){let n=t;return Object.keys(e).forEach(t=>{let o="";o="function"==typeof e[t]?e[t]():e[t],n=n.replace(`{{${t}}}`,e[t])}),n},applyValue:function t(e,...n){return"function"==typeof e?t(e(),...n):e},emptyChilds:function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}};const{Element:_}=window,S=_.prototype.append;_.prototype.append=function(){S.apply(this,[...arguments].filter(t=>!t.parentElement))};const g=_.prototype.appendChild;_.prototype.appendChild=function(){arguments.parentElement||g.apply(this,arguments)};var k=t=>{const{src:e,stylesheet:n,baseUrl:o="http://localhost"}=t,r=f("link",{attrs:{rel:"stylesheet",href:n},useSSR:!1}),a=f("script",{attrs:{src:e},useSSR:!1}),i=f("script",{attrs:{type:"text/javascript"},value:"window.__ssr = "+JSON.stringify(p),useSSR:!1}),c=f("script",{attrs:{type:"text/javascript"},useSSR:!1});return{setUrl:t=>jsdom.reconfigure({url:"http://localhost"+t}),toHtml(){const{document:t}=window;return w(c,"window.__cache = "+JSON.stringify(s)),console.log(i.parentElement),t.head.append(r),t.body.append(i,c,a),"<!DOCTYPE html>"+t.documentElement.outerHTML}}};export{k as SSR,l as fetcher,v as helpers,f as newEl,a as router,w as updateEl,E as updater};
//# sourceMappingURL=domerjs.modern.js.map
