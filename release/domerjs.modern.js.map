{"version":3,"file":"domerjs.modern.js","sources":["../src/presets/router.js","../src/index.js"],"sourcesContent":["const router = (func) => ({\r\n  router: true,\r\n  tag: 'div',\r\n  render: function () {\r\n    const { pathname } = window.location\r\n    return func(pathname)\r\n  },\r\n  windowEvents: {\r\n    popstate: function () {\r\n      // TODO: Maybe check if path is assigned to this router\r\n      this.update()\r\n    }\r\n  }\r\n})\r\n\r\nfunction pushRoute (entry, path) {\r\n  window.history.pushState({ path }, '', path)\r\n  const router = entry.getFirstParent((parent) => parent.router === true)\r\n  if (router) router.update()\r\n}\r\n\r\nconst link = (href, text, props) => ({\r\n  tag: 'a',\r\n  props: { href, ...props },\r\n  render: text,\r\n  events: {\r\n    click: function (e) {\r\n      e.preventDefault()\r\n      pushRoute(this, href)\r\n\r\n      // Scroll to tag title \r\n      const hashIndex = href.indexOf('#')\r\n      if (hashIndex !== -1) {\r\n        const hash = href.substring(hashIndex + 1)\r\n        const element = document.getElementById(hash)\r\n        if (element) window.scrollTo(0, element.offsetTop)\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\nexport default {\r\n  router,\r\n  link,\r\n  pushRoute\r\n}\r\n\r\n/*\r\nexport default (func) => {\r\n  const router = {\r\n    tag: 'div',\r\n    render: function () {\r\n      const { pathname } = window.location\r\n      return func(pathname)\r\n    },\r\n    windowEvents: {\r\n      popstate: function () {\r\n        this.update()\r\n      }\r\n    },\r\n    link: function (path, text) {\r\n      return {\r\n        tag: 'a',\r\n        props: { href: path },\r\n        render: text,\r\n        events: {\r\n          click: function (e) {\r\n            e.preventDefault()\r\n            window.history.pushState({ path }, '', path)\r\n            router.update()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return router\r\n}*/\r\n","import router from './presets/router'\r\nexport const routing = router\r\n\r\nfunction getAttrValue (entry, key) {\r\n  const { props = {} } = entry\r\n  if (typeof props[key] === 'function') return props[key].bind(entry).call()\r\n  return props[key]\r\n}\r\n\r\nfunction updateElementProps (entry) {\r\n  const { props = {}, element } = entry\r\n\r\n  Object.keys(props).forEach((key) => {\r\n    const newValue = getAttrValue(entry, key)\r\n    if (newValue === false) element.removeAttribute(key)\r\n    else element.setAttribute(key, newValue)\r\n  })\r\n}\r\n\r\nfunction setElementEvents (entry) {\r\n  entry.listeners = []\r\n  Object.keys(entry).forEach((key) => {\r\n    let element = null\r\n    if (key === 'events') element = entry.element\r\n    if (key === 'windowEvents') element = window\r\n    if (key === 'documentEvents') element = document\r\n    if (!element) return\r\n\r\n    const eventProps = entry[key]\r\n    Object.keys(eventProps).forEach((eventKey) => {\r\n      const eventFunc = eventProps[eventKey].bind(entry)\r\n      entry.listeners.push({ element, eventKey, eventFunc })\r\n      element.addEventListener(eventKey, eventFunc)\r\n    })\r\n  })\r\n}\r\n\r\nfunction clearElementEvents (entry) {\r\n  entry.listeners.forEach((listener) => {\r\n    const { element, eventKey, eventFunc } = listener\r\n    element.removeEventListener(eventKey, eventFunc)\r\n  })\r\n  entry.listeners = []\r\n}\r\n\r\nfunction setUpdateFunc (entry, options) {\r\n  entry.update = function () {\r\n    if (!this.mounted) return\r\n    traverse(this, null, options)\r\n    if (typeof entry.onUpdate === 'function') entry.onUpdate()\r\n  }\r\n}\r\n\r\nfunction setStateFunc (entry) {\r\n  entry.setState = function (props) {\r\n    Object.keys(props).forEach((key) => {\r\n      this.state[key] = props[key]\r\n    })\r\n    this.update()\r\n  }\r\n}\r\n\r\nfunction setGetFirstParentFunc (entry) {\r\n  entry.getFirstParent = function (func) {\r\n    if (!this.parent || !this.parent.getFirstParent) return null\r\n    if (func(this.parent)) return this.parent\r\n    return this.parent.getFirstParent(func)\r\n  }\r\n}\r\n\r\nfunction childrenToArray (children) {\r\n  let childs = []\r\n  if (Array.isArray(children)) {\r\n    // simple child array\r\n    childs = children\r\n  } else if (children && typeof children === 'object') {\r\n    if (children.tag) {\r\n      // if tag then object is actually a template definition\r\n      childs.push(children)\r\n    } else {\r\n      // object contains multiple template definition assigned by keys\r\n      childs = Object.values(children)\r\n    }\r\n  }\r\n\r\n  return childs\r\n}\r\n\r\nfunction mount (entry, parent, options) {\r\n  if (entry.mounted) return\r\n  // Assign default properties\r\n  if (parent) entry.parent = parent\r\n  if (options.context) entry.context = options.context\r\n  if (!entry.state) entry.state = {}\r\n\r\n  // Create element from DOM\r\n  entry.element = document.createElement(entry.tag)\r\n  entry.mounted = true\r\n\r\n  // Register events\r\n  setElementEvents(entry)\r\n\r\n  // Set helper functions\r\n  setUpdateFunc(entry, options)\r\n  setStateFunc(entry)\r\n  setGetFirstParentFunc(entry)\r\n\r\n  if (typeof entry.onMount === 'function') entry.onMount()\r\n}\r\n\r\nfunction unmount (entry) {\r\n  if (!entry.mounted) return\r\n  if (typeof entry.onUnMount === 'function') entry.onUnMount()\r\n  clearElementEvents(entry)\r\n  entry.parent = null\r\n  entry.element = null\r\n  entry.mounted = false\r\n\r\n  // Unmount childs recursive\r\n  childrenToArray(entry.children).forEach((child) => unmount(child))\r\n}\r\n\r\nfunction append (entry) {\r\n  if (entry.appended) return\r\n\r\n  entry.parent.element.appendChild(entry.element)\r\n  entry.appended = true\r\n\r\n  if (typeof entry.onAppend === 'function') entry.onAppend()\r\n}\r\n\r\nfunction detach (entry) {\r\n  if (!entry.appended) return\r\n  if (typeof entry.onDetach === 'function') entry.onDetach()\r\n  entry.parent.element.removeChild(entry.element)\r\n  entry.appended = false\r\n  // Detach childs recursive\r\n  childrenToArray(entry.children).forEach((child) => detach(child))\r\n}\r\n\r\nfunction funcRender (entry, render) {\r\n  if (typeof render === 'function') {\r\n    const result = entry.render()\r\n    //if (typeof result !== 'function') entry.children = result\r\n    return funcRender(entry, result)\r\n  }\r\n\r\n  return render\r\n}\r\n\r\nconst textRenderTypes = ['string', 'number']\r\n// Recursive function that compute the tree\r\nfunction traverse (entry, parent, options) {\r\n  // Apply all definition from entry obj [if not already mounted]\r\n  mount(entry, parent, options)\r\n\r\n  // Set element attributes everytime we traverse or update the entry (template)\r\n  updateElementProps(entry)\r\n\r\n  const oldChildren = entry.children\r\n  // Apply render might change entry.children\r\n  //applyRender(entry, entry.render)\r\n  const toRender = funcRender(entry, entry.render)\r\n  if (toRender) entry.children = toRender\r\n\r\n  const oldChildrenArray = childrenToArray(oldChildren)\r\n  const newChildrenArray = childrenToArray(entry.children)\r\n\r\n  // Detach and unmount old childs\r\n  oldChildrenArray.forEach((oldChild) => {\r\n    // Detach all child because they might not be in the same order\r\n    detach(oldChild)\r\n\r\n    // Unmount childs not return by render\r\n    const matchChild = newChildrenArray.find((newChild) => {\r\n      return newChild.element && oldChild.element.isEqualNode(newChild.element)\r\n    })\r\n\r\n    if (!matchChild) {\r\n      //detach(oldChild)\r\n      unmount(oldChild)\r\n    }\r\n  })\r\n\r\n  if (textRenderTypes.indexOf(typeof oldChildren) !== -1 && textRenderTypes.indexOf(typeof entry.children) === -1) {\r\n    if (entry.html) entry.element.innerHTML = ''\r\n    else entry.element.textContent = ''\r\n    //entry.appended = false\r\n  }\r\n\r\n  // When children is a string or number\r\n  if (textRenderTypes.indexOf(typeof entry.children) !== -1 && (entry.children !== oldChildren || !entry.appended)) {\r\n    if (entry.html) entry.element.innerHTML = entry.children\r\n    else entry.element.textContent = entry.children\r\n  }\r\n\r\n  // Apply childs\r\n  newChildrenArray.forEach((child) => {\r\n    traverse(child, entry, options)\r\n  })\r\n\r\n  if (toRender === false) detach(entry)\r\n  else append(entry)\r\n}\r\n\r\nexport function createApp (entry, rootElement, options) {\r\n  const parent = { element: rootElement }\r\n  traverse(entry, parent, options)\r\n}\r\n\r\n// Helpers\r\nexport function cl (styles, ...classNames) {\r\n  return classNames.map((className) => {\r\n    return styles[className]\r\n  }).join(' ')\r\n}\r\n\r\nfunction camelToDash (str) {\r\n  return str.replace(/\\W+/g, '-').replace(/([a-z\\d])([A-Z])/g, '$1-$2').toLowerCase()\r\n}\r\n\r\nexport function st (styles) {\r\n  let str = ''\r\n  Object.keys(styles).forEach((key) => {\r\n    str += `${camelToDash(key)}:${styles[key]};`\r\n  })\r\n  return str\r\n}\r\n\r\n// NODOM (SSR)\r\nfunction propsToString (entry) {\r\n  let s = ''\r\n  const { props = {} } = entry\r\n  Object.keys(props).forEach((key) => {\r\n    let sKey = key\r\n    if (sKey === 'className') sKey = 'class'\r\n    s += ` ${sKey}=\"${getAttrValue(entry, key)}\"`\r\n  })\r\n\r\n  return s\r\n}\r\n\r\nconst selfClosingTags = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr']\r\n\r\nexport function createHtml (entry, parent) {\r\n  if (parent && !entry.parent) entry.parent = parent\r\n\r\n  const propsString = propsToString(entry)\r\n  const { tag, render } = entry\r\n\r\n  if (selfClosingTags.indexOf(tag) !== -1) {\r\n    return `<${tag}${propsString}/>`\r\n  } else {\r\n    let childHtml = ''\r\n\r\n    if (typeof render === 'string') {\r\n      childHtml += render\r\n    }\r\n\r\n    let children = entry.children\r\n    if (typeof render === 'function') {\r\n      const result = entry.render()\r\n      if (typeof result === 'string') childHtml += result\r\n      else children = result\r\n    }\r\n\r\n    const childs = childrenToArray(children)\r\n    childs.forEach((child) => childHtml += createHtml(child, entry))\r\n\r\n    //if (!tag) return childHtml\r\n    return `<${tag}${propsString}>${childHtml}</${tag}>`\r\n  }\r\n}\r\n"],"names":["pushRoute","entry","path","window","history","pushState","router","getFirstParent","parent","update","routing","func","tag","render","pathname","location","windowEvents","popstate","this","link","href","text","props","events","click","e","preventDefault","hashIndex","indexOf","hash","substring","element","document","getElementById","scrollTo","offsetTop","getAttrValue","key","bind","call","childrenToArray","children","childs","Array","isArray","push","Object","values","detach","appended","onDetach","removeChild","forEach","child","textRenderTypes","createApp","rootElement","options","traverse","mounted","context","state","createElement","listeners","keys","eventProps","eventKey","eventFunc","addEventListener","setElementEvents","onUpdate","setUpdateFunc","setState","setStateFunc","setGetFirstParentFunc","onMount","mount","newValue","removeAttribute","setAttribute","updateElementProps","oldChildren","toRender","funcRender","result","oldChildrenArray","newChildrenArray","oldChild","find","newChild","isEqualNode","unmount","onUnMount","listener","removeEventListener","clearElementEvents","html","innerHTML","textContent","appendChild","onAppend","append","cl","styles","classNames","map","className","join","st","str","replace","toLowerCase","camelToDash","selfClosingTags","createHtml","propsString","s","sKey","propsToString","childHtml"],"mappings":"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"}